---
title: "Seminar 5"
author: "Maria Kravchuk"
date: "14 03 2022"
output: word_document
---

Note: for loading data I will using the absolute path to avoid problems with IDE
```{r}
suppressPackageStartupMessages(library(igraph))
suppressPackageStartupMessages(library(network))
suppressPackageStartupMessages(library(magrittr))
suppressPackageStartupMessages(library(data.table))
suppressPackageStartupMessages(library(igraph))
suppressPackageStartupMessages(library(sna))
suppressPackageStartupMessages(library("readxl"))
```
```{r}
all_net<-read.csv("/home/mwkrvc/Documents/net/AllNet.csv", sep=';', header=TRUE)
all_mat<-as.matrix(all_net)
all_graph<-graph_from_adjacency_matrix(all_mat)
```
```{r}
ocb_att<-read.csv('/home/mwkrvc/Documents/net/OCB_att.csv', header = TRUE)
age<-ocb_att$Age
sex<-ocb_att$Sex
#How long the person had this position:
tenure<-ocb_att$WorkTitleYear + ocb_att$WorkTitleMonth / 12
#How long worked in organization:
tenure_org<-ocb_att$WorkOrgYear+ocb_att$WorkOrgMonth / 12
#How long reported to the same supervisor:
tenure_sup<-ocb_att$RepSupYear + ocb_att$RepSupMonth / 12
# Set of dummies for education:
ed1<-ifelse(ocb_att$Education==3, 1, 0) # this is for secondary specialized
ed2<-ifelse(ocb_att$Education==4, 1, 0) # this is higher
#Physical participation variable
phys_part<-ocb_att$Phys_Part
title<-ocb_att$Title
# Set of dummies for work title
ast_department_head<-ifelse(title=="Assistant department head", 1, 0)
department_director<-ifelse(title=="Department director", 1, 0)
department_head<-ifelse(title=="Department head", 1, 0)
head_lawyer<-ifelse(title=="Head lawyer", 1, 0)
lawyer<-ifelse(title=="Lawyer", 1, 0)
lead_specialist<-ifelse(title=="Lead specialist", 1, 0)
project_manager<-ifelse(title=="Project manager", 1 ,0)
specialist<-ifelse(title=="Specialist", 1 ,0)
subsidary_manager<-ifelse(title=="Subsidiary manager", 1, 0)
```

```{r}
model<-lm(phys_part~age+sex+tenure+tenure_org+tenure_sup+ed1+ed2)
summary(model)
```

Fitted plot - should not show fitted pattern.
In our case, there is one present
Scale-location plot
The plot shows that the residuals are not spread equally along the ranges of predictors so we cannot assume homogeneity
QQ PLot of Residuals
We can assume normality since the points fall approximately along the reference

```{r}
plot(model)
```

```{r}
suppressPackageStartupMessages(library(MASS))
```
```{r}
sresid<-studres(model)
shapiro.test(sresid)
```

From the p-value = 0.0979 > 0.05 we can assume normality since the distribution of the data is not significantly different from normal

```{r}
cor_mat<-cbind(phys_part,age, sex, tenure, tenure_org, tenure_sup, ed1, ed2)
cor(cor_mat)
```

```{r}
model<-lm(phys_part~tenure + tenure_sup)
summary(model)
```

```{r}
title_model<-lm(phys_part~tenure + tenure_sup +
                  ast_department_head +
                  department_director +
                  department_head +
                  head_lawyer +
                  lawyer +
                  lead_specialist +
                  project_manager +
                  specialist +
                  subsidary_manager)
summary(title_model)
```

Assignment 2
Through continuous elimination none of the newly added variables seem to be significant

For this exercise, we are examining three potential dependent variables: emotional participation, intent to leave and personal conflicts. They are thereoretically related to high turnover rate according to a large number of studies

```{r}
HR_att<-read.csv("/home/mwkrvc/Documents/net/OCB_att.csv",header=TRUE)
#Let's get the sex of our respondents into its own vector:
sex<-HR_att$Sex
age<-HR_att$Age
#Dependent variables
Emotional_part<-HR_att$Emot_Part
Intent_to_leave<-HR_att$Intent_toLeave
Personal_conflicts<-HR_att$Personal_conflicts
#Predictors
#Challenge stressors:
Work_Quant<-HR_att$Work_quant #Work quantity
Work_Resp<-HR_att$Work_Resp #Work responsibility
Work_Diff<-HR_att$Work_Diff #work difficulty
Work_Speed<-HR_att$Work_Speed # Work speed
#Hindrance stressors:
Admin_problems<-HR_att$Admin_problems
Personal_conflicts<-HR_att$Personal_conflicts
```

```{r}
Model1<-lm(Emotional_part~Work_Resp+Work_Diff)
summary(Model1)
```

Statistically, the model is good. It has highly significant F-statistic (meaning that it is highly unlikely that
this model is a random, chance model). Percentage of variance explained is also substantial - almost 35%.
As we can see from the results, the two variables in the model are significant and theoretically solid. When
people invest in their job, having a lot of responsibility and work of sufficient significance, they feel more
emotionally invested in their work.

```{r}
Model1a<-lm(Emotional_part~Work_Resp+Work_Diff+sex+age)
summary(Model1a)
```

Insignificant variables should be removed from the model. We have also tried to add some of
the hindrance stressors:

```{r}
Model1b<-lm(Emotional_part~Work_Resp+Work_Diff+Admin_problems+Personal_conflicts)
summary(Model1b)
```

```{r}
Work_Demands<-HR_att$Work_Demands
Education<-HR_att$Education
new_model<-lm(Emotional_part~Work_Resp+Work_Demands+age)
summary(new_model)
```

```{r}
Model1b_add<-lm(Emotional_part~Work_Resp+Work_Diff+Admin_problems+Personal_conflicts+Work_Demands)
summary(Model1b_add)
```

Variable "Work Demands" turned out to be significant

Network indices as predictors

Create the networks needed and dichotomize the data

```{r}
FriendMat<-read.csv("/home/mwkrvc/Documents/net/FriendShipNet.csv", sep=';', header=TRUE)
FriendMat<-as.matrix(FriendMat)
ProfMat<-read.csv("/home/mwkrvc/Documents/net/ProfNet.csv", sep=";", header = TRUE)
ProfMat<-as.matrix(ProfMat)
BossMat<-read.csv("/home/mwkrvc/Documents/net/BossNet.csv", sep=";", header=TRUE)
BossMat<-as.matrix(BossMat)
SupportMat<-read.csv("/home/mwkrvc/Documents/net/SupportNet.csv", sep=";", header=TRUE)
SupportMat<-as.matrix(SupportMat)
```


```{r}
Friend.any <- ifelse(FriendMat > 0, 1, 0)
Boss.any <- ifelse(BossMat > 0, 1, 0)
Prof.any <- ifelse(ProfMat > 0, 1, 0)
Support.any <- ifelse(SupportMat > 0, 1, 0)
```


```{r}
FriendGraph<-graph_from_adjacency_matrix(FriendMat, weighted=TRUE)
ProfGraph<-graph_from_adjacency_matrix(ProfMat, weighted=TRUE)
BossGraph<-graph_from_adjacency_matrix(BossMat, weighted=TRUE)
SupportGraph<-graph_from_adjacency_matrix(SupportMat, weighted=TRUE)
FriendGraph.any <-graph.adjacency(Friend.any,
mode=c("directed"),
weighted=NULL,
diag=FALSE)
BossGraph.any <-graph.adjacency(Boss.any,
mode=c("directed"),
weighted=NULL,
diag=FALSE)
ProfGraph.any <-graph.adjacency(Prof.any,
mode=c("directed"),
weighted=NULL,
diag=FALSE)
SupportGraph.any<-graph.adjacency(Support.any,
mode=c("directed"),
weighted=NULL,
diag=FALSE)
```

```{r}
FriendGraph.any
```

I am specifying the namespace since there is a conflict with sna's methods

```{r}
indegree_Friend <- igraph::degree(FriendGraph.any, mode='in')
outdegree_Friend <- igraph::degree(FriendGraph.any, mode='out')
total_degree_Friend <- igraph::degree(FriendGraph.any, mode='total')
indegree_Support <- igraph::degree(SupportGraph.any, mode='in')
outdegree_Support <- igraph::degree(SupportGraph.any, mode='out')
total_degree_Support <- igraph::degree(SupportGraph.any, mode='total')
indegree_Prof <- igraph::degree(ProfGraph.any, mode='in')
outdegree_Prof <- igraph::degree(ProfGraph.any, mode='out')
total_degree_Prof <- igraph::degree(ProfGraph.any, mode='total')
#Betweenness and eigenvector: professional network?
betweenness_Prof <- igraph::betweenness(ProfGraph.any)
Prof_Evcent <- igraph::evcent(ProfGraph.any)
Prof_eigen <- Prof_Evcent$vector
```

```{r}
names<-ocb_att$Name
education<-ocb_att$Education
gender_vector<-vector()
age_vector<-vector()
education_vector<-vector()
work_exp_vector<-vector()
for(i in 1:122)
{
  for(j in 1:68)
  {
    if(V(all_graph)$name[i]==names[j])
    {
      gender_vector[i]<-sex[j]
      age_vector[i]<-age[j]
      education_vector[i]<-education[j]
      work_exp_vector[i]<-tenure_org[j]
      break;
    }
    else
    {
      gender_vector[i]<-NA
      age_vector[i]<-NA
      education_vector[i]<-NA
      work_exp_vector[i]<-NA
    }
  }
}
```


```{r}
age_groups<-ifelse(is.na(age_vector), 0, ifelse(age_vector >= 20 & age_vector < 30, 1, ifelse(age_vector >= 30 & age_vector < 40, 2, ifelse(age_vector>=40 & age_vector < 52, 3, 4))))
all_graph<-set_vertex_attr(all_graph, 'gender', value=c(gender_vector))
all_graph<-set_vertex_attr(all_graph, 'age', value=c(age_groups))
all_graph<-set_vertex_attr(all_graph, 'education', value=c(education_vector))
colors<-ifelse(age_groups==1, 'gray20', ifelse(age_groups==2, 'gray60', ifelse(age_groups==3, 'gray99', 'tomato')))
sides<-ifelse(gender_vector==1,"circle",
                             ifelse(gender_vector==0,"square","csquare"))
sides<-ifelse(is.na(sides), 'csquare', sides)
par(mar=c(0,0,1,0))
plot(all_graph, vertex.size=7, vertex.color=colors,
     vertex.shape = sides,
     edge.arrow.size=.2, edge.color="black",
     vertex.label=NA, main="Additional attributes")
```





